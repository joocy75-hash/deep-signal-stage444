<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepSignal · Bitcoin Pulse Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        :root {
            --btc-orange: #f7931a;
            --btc-glow: #ffb347;
            --bg-dark: #030306;
            --panel: rgba(9, 12, 22, 0.92);
            --panel-border: rgba(255, 255, 255, 0.08);
            --text-primary: #fefefe;
            --text-muted: #99a0b5;
            --accent: #36e6ad;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: 'SUIT', 'Pretendard', 'Segoe UI', sans-serif;
            min-height: 100vh;
            color: var(--text-primary);
            background: radial-gradient(circle at top, rgba(255, 195, 113, 0.2), var(--bg-dark) 50%);
            overflow-x: hidden;
            animation: aurora 18s ease-in-out infinite alternate;
        }

        body::before,
        body::after {
            content: '';
            position: fixed;
            width: 280px;
            height: 280px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(247,147,26,0.35), transparent 60%);
            z-index: 0;
            filter: blur(5px);
            animation: float 12s linear infinite;
        }

        body::before { top: -60px; right: 5%; animation-delay: 0s; }
        body::after { bottom: -60px; left: 8%; animation-delay: 4s; }

        @keyframes aurora {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes float {
            0% { transform: translateY(0); opacity: 0.4; }
            50% { transform: translateY(-20px); opacity: 0.7; }
            100% { transform: translateY(0); opacity: 0.4; }
        }

        .app-shell {
            position: relative;
            z-index: 2;
            max-width: 1400px;
            margin: 0 auto;
            padding: 48px 24px 80px;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 24px;
            margin-bottom: 32px;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .brand-mark {
            width: 64px;
            height: 64px;
            border-radius: 24px;
            background: linear-gradient(145deg, #f9aa4b, #ff7b02);
            box-shadow: 0 10px 30px rgba(247, 147, 26, 0.45);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: #121218;
            font-weight: 700;
        }

        .brand-copy small {
            display: block;
            text-transform: uppercase;
            letter-spacing: 0.25em;
            font-size: 11px;
            color: var(--text-muted);
        }

        .brand-copy strong {
            font-size: 28px;
            font-weight: 600;
            letter-spacing: 0.03em;
        }

        .top-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn {
            border: none;
            border-radius: 16px;
            padding: 12px 22px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            color: #fff;
            transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.2s;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.12);
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.25);
        }

        .btn:disabled { opacity: 0.4; cursor: not-allowed; }

        .btn-primary {
            background: linear-gradient(120deg, #f7931a, #ffba6a);
            color: #241400;
            box-shadow: 0 12px 25px rgba(247, 147, 26, 0.4);
        }

        .status-chip {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 18px;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,0.15);
            background: rgba(0,0,0,0.25);
            font-weight: 600;
            letter-spacing: 0.04em;
        }

        .status-chip .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            box-shadow: 0 0 12px currentColor;
        }

        .status-chip.connected .dot { color: #36e6ad; background: #36e6ad; }
        .status-chip.connecting .dot { color: #f7c948; background: #f7c948; }
        .status-chip.disconnected .dot { color: #ff4d6d; background: #ff4d6d; }

        .btc-hero {
            position: relative;
            margin-bottom: 32px;
            border-radius: 32px;
            padding: 32px 32px 36px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
            background: radial-gradient(circle at 20% 20%, rgba(255,196,132,0.3), rgba(7,10,20,0.95));
        }

        .btc-hero::after {
            content: '';
            position: absolute;
            inset: 0;
            background: url('https://assets.codepen.io/1462889/glow-lines.png') repeat;
            opacity: 0.2;
            mix-blend-mode: screen;
            animation: drift 20s linear infinite;
        }

        @keyframes drift {
            from { transform: translateX(0); }
            to { transform: translateX(-200px); }
        }

        .btc-hero-content {
            display: flex;
            flex-wrap: wrap;
            gap: 32px;
            position: relative;
            z-index: 2;
        }

        .btc-copy {
            flex: 1 1 320px;
        }

        .btc-copy h1 {
            font-size: clamp(28px, 4vw, 42px);
            margin: 0 0 12px;
            line-height: 1.2;
        }

        .btc-copy p {
            margin: 0;
            color: var(--text-muted);
            font-size: 15px;
        }

        .btc-coin {
            position: relative;
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: radial-gradient(circle, #ffe9c4 0%, #f7931a 50%, #b75b00 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 72px;
            color: #231102;
            box-shadow: 0 25px 60px rgba(247, 147, 26, 0.4);
            animation: coinSpin 12s linear infinite;
        }

        .btc-coin::after,
        .btc-coin::before {
            content: '';
            position: absolute;
            inset: -12px;
            border-radius: 50%;
            border: 2px dashed rgba(255,255,255,0.25);
            animation: orbit 8s linear infinite;
        }

        .btc-coin::before {
            border-style: solid;
            border-color: rgba(255,255,255,0.12);
            animation-duration: 14s;
        }

        @keyframes coinSpin {
            from { transform: rotateY(0deg); }
            to { transform: rotateY(360deg); }
        }

        @keyframes orbit {
            to { transform: rotate(360deg); }
        }

        .hero-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }

        .hero-metric {
            padding: 14px 18px;
            border-radius: 18px;
            background: rgba(0,0,0,0.35);
            border: 1px solid rgba(255,255,255,0.08);
        }

        .hero-metric span {
            display: block;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .hero-metric strong {
            font-size: 20px;
        }

        .global-banner {
            margin-bottom: 28px;
            padding: 16px 20px;
            border-radius: 18px;
            border: 1px solid rgba(255,255,255,0.12);
            background: rgba(0,0,0,0.35);
            backdrop-filter: blur(14px);
            display: flex;
            gap: 12px;
            align-items: center;
            font-weight: 500;
        }

        .global-banner.success { border-color: rgba(54,230,173,0.4); color: #36e6ad; }
        .global-banner.error { border-color: rgba(255,77,109,0.5); color: #ff7a93; }
        .global-banner.info { border-color: rgba(247,147,26,0.5); color: var(--btc-glow); }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 18px;
            margin-bottom: 30px;
        }

        .summary-card {
            position: relative;
            overflow: hidden;
            padding: 20px;
            border-radius: 24px;
            border: 1px solid rgba(255,255,255,0.12);
            background: var(--panel);
            backdrop-filter: blur(16px);
        }

        .summary-card::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top right, rgba(255,255,255,0.2), transparent 50%);
            opacity: 0;
            transition: opacity 0.4s;
        }

        .summary-card:hover::after { opacity: 1; }

        .summary-card h4 {
            margin: 0;
            color: var(--text-muted);
            font-size: 13px;
            letter-spacing: 0.12em;
            text-transform: uppercase;
        }

        .summary-value {
            font-size: 34px;
            font-weight: 600;
            margin: 12px 0 6px;
        }

        .summary-meta {
            display: flex;
            justify-content: space-between;
            color: var(--text-muted);
            font-size: 13px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 3fr 2fr;
            gap: 24px;
        }

        .panel {
            border-radius: 28px;
            padding: 26px;
            background: var(--panel);
            border: 1px solid var(--panel-border);
            backdrop-filter: blur(16px);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .panel-header h3 {
            margin: 0;
            font-size: 20px;
        }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border-radius: 999px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.12);
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .input-field,
        select.input-field {
            width: 100%;
            border-radius: 16px;
            padding: 14px 16px;
            border: 1px solid rgba(255,255,255,0.14);
            background: rgba(0,0,0,0.3);
            color: var(--text-primary);
            font-weight: 500;
        }

        .insight-list {
            display: grid;
            gap: 14px;
        }

        .insight-item {
            padding: 16px;
            border-radius: 18px;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead th {
            text-align: left;
            font-size: 12px;
            opacity: 0.6;
            padding-bottom: 12px;
            letter-spacing: 0.12em;
        }

        tbody td {
            padding: 14px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 14px;
        }

        .pnl-positive { color: #36e6ad; }
        .pnl-negative { color: #ff7a93; }

        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(3,3,6,0.9);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 80px;
            z-index: 1000;
            backdrop-filter: blur(6px);
        }

        .modal-card {
            width: min(520px, 92vw);
            background: #080a12;
            border-radius: 28px;
            padding: 32px;
            border: 1px solid rgba(255,255,255,0.08);
        }

        .modal-card h3 {
            margin: 0 0 12px;
            font-size: 24px;
        }

        .modal-desc {
            margin-bottom: 20px;
            color: var(--text-muted);
            font-size: 14px;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 24px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0,1fr));
            gap: 12px;
            font-size: 14px;
        }

        @media (max-width: 1024px) {
            .main-grid { grid-template-columns: 1fr; }
            .btc-hero-content { flex-direction: column; align-items: center; }
        }

        @media (max-width: 640px) {
            .top-bar { flex-direction: column; align-items: flex-start; }
        }
    </style>
</head>
<body>
    <div id="app" class="app-shell">
        <header class="top-bar">
            <div class="brand">
                <div class="brand-mark">₿</div>
                <div class="brand-copy">
                    <small>DeepSignal Intelligence</small>
                    <strong>Bitcoin Pulse Control</strong>
                </div>
            </div>
            <div class="top-actions">
                <div class="status-chip" :class="connectionStatus">
                    <span class="dot"></span>
                    {{ connectionStatusText }}
                </div>
                <button class="btn btn-primary" @click="showConfigModal = true">
                    <i class="fas fa-sliders-h"></i> 연결 설정
                </button>
            </div>
        </header>

        <section class="btc-hero">
            <div class="btc-hero-content">
                <div class="btc-copy">
                    <h1>새로운 비트코인 AI 시그널</h1>
                    <p>실시간 온체인 데이터와 시장 미세 구조를 결합한 DeepSignal의 차세대 트레이딩 엔진입니다.</p>
                    <div class="hero-metrics">
                        <div class="hero-metric">
                            <span>활성 전략</span>
                            <strong>{{ tradingActive ? '실행 중' : '대기 중' }}</strong>
                        </div>
                        <div class="hero-metric">
                            <span>AI 신호</span>
                            <strong>{{ aiSignalStatus }}</strong>
                        </div>
                        <div class="hero-metric">
                            <span>라이브 포지션</span>
                            <strong>{{ openPositions.length }} 개</strong>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="btc-coin">
                        ₿
                    </div>
                </div>
            </div>
        </section>

        <transition name="fade">
            <div class="global-banner" :class="messageType" v-if="message">
                <i class="fas" :class="{
                    'fa-check-circle': messageType === 'success',
                    'fa-circle-info': messageType === 'info',
                    'fa-circle-exclamation': messageType === 'error'
                }"></i>
                {{ message }}
            </div>
        </transition>

        <section class="summary-grid">
            <article class="summary-card">
                <h4>총 계좌 잔고</h4>
                <div class="summary-value">${{ formatNumber(accountBalance) }}</div>
                <div class="summary-meta">
                    <span>현금성 자산</span>
                    <span :class="profit24h >= 0 ? 'pnl-positive' : 'pnl-negative'">
                        {{ profit24h >= 0 ? '+' : ''}}{{ profit24h.toFixed(2) }}%
                    </span>
                </div>
            </article>
            <article class="summary-card">
                <h4>총 자산 가치</h4>
                <div class="summary-value">${{ formatNumber(totalAssetValue) }}</div>
                <div class="summary-meta">
                    <span>AI 최적화 배분</span>
                    <span>{{ openPositions.length }}개 포지션</span>
                </div>
            </article>
            <article class="summary-card">
                <h4>AI 신뢰도</h4>
                <div class="summary-value">{{ tradingActive ? 'Live' : 'Idle' }}</div>
                <div class="summary-meta">
                    <span>{{ aiSignalStatus }}</span>
                    <span>{{ runningTime }}</span>
                </div>
            </article>
            <article class="summary-card">
                <h4>연결 상태</h4>
                <div class="summary-value" :class="isConnected ? 'pnl-positive' : 'pnl-negative'">
                    {{ isConnected ? 'Connected' : 'Offline' }}
                </div>
                <div class="summary-meta">
                    <span>엔드포인트</span>
                    <span>{{ backendUrl }}</span>
                </div>
            </article>
        </section>

        <section class="main-grid">
            <div class="panel">
                <div class="panel-header">
                    <h3>비트코인 트레이딩 콘솔</h3>
                    <span class="pill"><i class="fas fa-bolt"></i> {{ tradingActive ? '신호 송출 중' : '대기 중' }}</span>
                </div>

                <div class="control-grid">
                    <div>
                        <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:6px;">거래 심볼</label>
                        <select class="input-field" v-model="selectedSymbol">
                            <option>BTCUSDT</option>
                            <option>ETHUSDT</option>
                            <option>BNBUSDT</option>
                            <option>SOLUSDT</option>
                        </select>
                    </div>
                    <div>
                        <label style="font-size:12px;color:var(--text-muted);display:block;margin-bottom:6px;">실행 상태</label>
                        <div class="input-field" style="font-weight:600;">
                            {{ tradingActive ? 'AI 자동매매 실행 중' : '대기 중' }}
                        </div>
                    </div>
                </div>

                <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:20px;">
                    <button class="btn btn-primary" @click="startTrading" :disabled="!isConnected || tradingActive">
                        <i class="fas fa-play"></i> 전략 시작
                    </button>
                    <button class="btn" @click="stopTrading" :disabled="!tradingActive">
                        <i class="fas fa-stop"></i> 즉시 중지
                    </button>
                </div>

                <div class="insight-list">
                    <div class="insight-item">
                        <strong>시스템 로그</strong>
                        <p style="margin:6px 0 0;color:var(--text-muted);font-size:14px;">
                            {{ aiSignalStatus }} · {{ openPositions.length }}개의 포지션 모니터링 중
                        </p>
                    </div>
                    <div class="insight-item">
                        <strong>데이터 동기화</strong>
                        <p style="margin:6px 0 0;color:var(--text-muted);font-size:14px;">
                            {{ isConnected ? '백엔드에서 실시간 데이터를 수신하고 있습니다.' : '연결을 설정하면 라이브 데이터가 표시됩니다.' }}
                        </p>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <h3>포지션 인사이트</h3>
                    <span class="pill"><i class="fas fa-layer-group"></i> {{ openPositions.length }} Positions</span>
                </div>

                <div v-if="!isConnected" class="insight-item" style="border-style:dashed;">
                    백엔드 연결 후 실제 포지션이 여기에 표시됩니다.
                </div>
                <div v-else-if="openPositions.length === 0" class="insight-item" style="border-style:dashed;">
                    현재 오픈 포지션이 없습니다.
                </div>
                <div v-else style="overflow-x:auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>자산</th>
                                <th>수량</th>
                                <th>진입가</th>
                                <th>현재가</th>
                                <th>손익</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="position in openPositions" :key="position.symbol">
                                <td>{{ position.symbol }}</td>
                                <td>{{ position.amount }}</td>
                                <td>${{ position.entryPrice.toFixed(2) }}</td>
                                <td>${{ position.currentPrice.toFixed(2) }}</td>
                                <td :class="position.pnl >= 0 ? 'pnl-positive' : 'pnl-negative'">
                                    ${{ position.pnl.toFixed(2) }} ({{ position.pnlPercent?.toFixed(2) }}%)
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="metrics-grid" style="margin-top:18px;">
                    <div>백엔드 URL</div>
                    <div>{{ backendUrl }}</div>
                    <div>마지막 점검</div>
                    <div>{{ lastCheck }}</div>
                </div>
            </div>
        </section>

        <div v-if="showConfigModal" class="modal-backdrop">
            <div class="modal-card">
                <h3>백엔드 연결 설정</h3>
                <p class="modal-desc">
                    DeepSignal 백엔드 엔드포인트를 입력하고 연결 상태를 확인하세요. 설정은 로컬에 안전하게 저장됩니다.
                </p>

                <label style="font-size:14px;color:var(--text-muted);display:block;margin-bottom:6px;">백엔드 URL</label>
                <input class="input-field" type="text" v-model="backendUrl" placeholder="http://localhost:8001">
                <small style="color:var(--text-muted);display:block;margin-top:6px;">예: http://localhost:8001</small>

                <div class="modal-actions">
                    <button class="btn" style="flex:1 1 150px;" @click="testConnection" :disabled="testingConnection">
                        <span v-if="testingConnection"><i class="fas fa-spinner fa-spin"></i> 테스트 중...</span>
                        <span v-else>연결 테스트</span>
                    </button>
                    <button class="btn btn-primary" style="flex:1 1 180px;" @click="saveAndConnect" :disabled="!connectionSuccess">
                        저장 후 연결
                    </button>
                    <button class="btn" style="flex:1 1 100px;" @click="showConfigModal = false">
                        닫기
                    </button>
                </div>

                <div style="margin-top:24px;padding:18px;border-radius:20px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);">
                    <h4 style="margin:0 0 12px;">연결 진단</h4>
                    <div class="metrics-grid">
                        <div>연결 상태</div>
                        <div :class="isConnected ? 'pnl-positive' : 'pnl-negative'">
                            {{ isConnected ? '활성화' : '비활성' }}
                        </div>
                        <div>테스트 결과</div>
                        <div>{{ connectionSuccess ? '성공' : '대기 중' }}</div>
                        <div>마지막 확인</div>
                        <div>{{ lastCheck }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                isConnected: false,
                connectionSuccess: false,
                testingConnection: false,
                connecting: false,
                connectionStatus: 'disconnected',
                message: '백엔드 연결을 설정해주세요',
                messageType: 'info',
                showConfigModal: true,
                backendUrl: 'http://localhost:8001',
                lastCheck: '아직 없음',
                tradingActive: false,
                selectedSymbol: 'BTCUSDT',
                aiSignalStatus: '대기 중',
                runningTime: '00:00:00',
                runningSeconds: 0,
                runningTimer: null,
                accountBalance: 0,
                totalAssetValue: 0,
                profit24h: 0,
                openPositions: [],
                dataUpdateInterval: null
            },
            computed: {
                connectionStatusText() {
                    return {
                        'connected': '백엔드 연결됨',
                        'connecting': '연결 중...',
                        'disconnected': '연결 끊김'
                    }[this.connectionStatus];
                }
            },
            methods: {
                async testConnection() {
                    if (!this.backendUrl) {
                        this.showMessage('백엔드 URL을 입력해주세요', 'error');
                        return;
                    }
                    this.testingConnection = true;
                    this.showMessage('백엔드 연결 테스트 중...', 'info');
                    try {
                        const response = await axios.get(`${this.backendUrl}/api/health`, { timeout: 5000 });
                        if (response.data.status === 'OK') {
                            this.showMessage('✅ 백엔드 연결 성공!', 'success');
                            this.connectionSuccess = true;
                            this.lastCheck = new Date().toLocaleTimeString();
                        } else {
                            throw new Error('백엔드 상태 이상: ' + JSON.stringify(response.data));
                        }
                    } catch (error) {
                        this.showMessage(`❌ 연결 실패: ${error.message}`, 'error');
                        this.connectionSuccess = false;
                        this.lastCheck = new Date().toLocaleTimeString();
                    } finally {
                        this.testingConnection = false;
                    }
                },
                async saveAndConnect() {
                    if (!this.connectionSuccess) {
                        this.showMessage('먼저 연결 테스트를 성공해야 합니다', 'error');
                        return;
                    }
                    localStorage.setItem('deepSignalBackendUrl', this.backendUrl);
                    await this.connectToBackend();
                    this.showConfigModal = false;
                },
                async connectToBackend() {
                    this.connecting = true;
                    this.connectionStatus = 'connecting';
                    this.showMessage('백엔드에 연결 중...', 'info');
                    try {
                        const response = await axios.get(`${this.backendUrl}/api/health`);
                        if (response.data.status === 'OK') {
                            this.isConnected = true;
                            this.connectionStatus = 'connected';
                            this.showMessage('✅ 백엔드 연결 성공! 데이터를 불러오는 중...', 'success');
                            await this.loadAccountInfo();
                            this.startDataUpdates();
                        } else {
                            throw new Error('백엔드 상태 이상');
                        }
                    } catch (error) {
                        this.isConnected = false;
                        this.connectionStatus = 'disconnected';
                        this.showMessage(`❌ 연결 실패: ${error.message}`, 'error');
                    } finally {
                        this.connecting = false;
                    }
                },
                async loadAccountInfo() {
                    if (!this.isConnected) return;
                    try {
                        const [accountResponse, dashboardResponse, positionsResponse] = await Promise.all([
                            axios.get(`${this.backendUrl}/api/trading/account`),
                            axios.get(`${this.backendUrl}/api/dashboard`),
                            axios.get(`${this.backendUrl}/api/trading/positions`)
                        ]);
                        this.accountBalance = accountResponse.data.totalBalance || 10000;
                        this.totalAssetValue = accountResponse.data.totalBalance || 12500;
                        this.openPositions = positionsResponse.data || [];
                        this.calculateProfit();
                        this.showMessage('✅ 데이터 로드 완료!', 'success');
                    } catch (error) {
                        this.showMessage('데이터 로드 실패, Mock 데이터 사용 중', 'error');
                        this.useMockData();
                    }
                },
                useMockData() {
                    this.accountBalance = 10000;
                    this.totalAssetValue = 12500;
                    this.profit24h = 2.5;
                    this.openPositions = [
                        { symbol: 'BTCUSDT', amount: 0.1, entryPrice: 34000, currentPrice: 35000, pnl: 1000, pnlPercent: 2.94 },
                        { symbol: 'ETHUSDT', amount: 2.5, entryPrice: 1800, currentPrice: 1850.75, pnl: 126.88, pnlPercent: 2.82 }
                    ];
                },
                calculateProfit() {
                    if (this.openPositions.length > 0) {
                        const totalPnl = this.openPositions.reduce((sum, pos) => sum + (pos.pnl || 0), 0);
                        const totalInvestment = this.openPositions.reduce((sum, pos) => sum + ((pos.amount || 0) * (pos.entryPrice || 0)), 0);
                        this.profit24h = totalInvestment > 0 ? (totalPnl / totalInvestment) * 100 : 0;
                    } else {
                        this.profit24h = 0;
                    }
                },
                startDataUpdates() {
                    this.dataUpdateInterval = setInterval(() => {
                        if (this.isConnected) {
                            this.loadAccountInfo();
                        }
                    }, 5000);
                },
                async startTrading() {
                    if (!this.isConnected) {
                        this.showMessage('먼저 백엔드를 연결해주세요', 'error');
                        return;
                    }
                    try {
                        this.showMessage('AI 트레이딩 시작 중...', 'info');
                        const response = await axios.post(`${this.backendUrl}/api/ai-trading/start`, {
                            symbols: [this.selectedSymbol],
                            investmentPerTrade: 100,
                            maxOpenTrades: 2,
                            riskRewardRatio: 1.5,
                            checkInterval: 60000
                        });
                        if (response.data.success) {
                            this.tradingActive = true;
                            this.aiSignalStatus = '신호 감지 중';
                            this.startRunningTimer();
                            this.showMessage('✅ AI 트레이딩 시작됨!', 'success');
                        } else {
                            this.showMessage('트레이딩 시작 실패: ' + response.data.error, 'error');
                        }
                    } catch (error) {
                        this.showMessage('트레이딩 시작 실패: ' + error.message, 'error');
                    }
                },
                async stopTrading() {
                    try {
                        this.showMessage('AI 트레이딩 중지 중...', 'info');
                        const response = await axios.post(`${this.backendUrl}/api/ai-trading/stop`);
                        if (response.data.success) {
                            this.tradingActive = false;
                            this.aiSignalStatus = '중지됨';
                            this.stopRunningTimer();
                            this.showMessage('✅ AI 트레이딩 중지됨!', 'success');
                        } else {
                            this.showMessage('트레이딩 중지 실패: ' + response.data.error, 'error');
                        }
                    } catch (error) {
                        this.showMessage('트레이딩 중지 실패: ' + error.message, 'error');
                    }
                },
                startRunningTimer() {
                    this.runningSeconds = 0;
                    this.runningTimer = setInterval(() => {
                        this.runningSeconds++;
                        this.updateRunningTime();
                    }, 1000);
                },
                stopRunningTimer() {
                    if (this.runningTimer) {
                        clearInterval(this.runningTimer);
                        this.runningTimer = null;
                    }
                },
                updateRunningTime() {
                    const hours = Math.floor(this.runningSeconds / 3600);
                    const minutes = Math.floor((this.runningSeconds % 3600) / 60);
                    const seconds = this.runningSeconds % 60;
                    this.runningTime = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                },
                showMessage(text, type) {
                    this.message = text;
                    this.messageType = type;
                    const timeout = type === 'error' ? 8000 : 5000;
                    setTimeout(() => {
                        if (this.message === text) {
                            this.message = '';
                        }
                    }, timeout);
                },
                formatNumber(num) {
                    return typeof num === 'number' ? num.toLocaleString() : '0';
                }
            },
            mounted() {
                const savedUrl = localStorage.getItem('deepSignalBackendUrl');
                if (savedUrl) {
                    this.backendUrl = savedUrl;
                    this.connectToBackend();
                }
            },
            beforeDestroy() {
                this.stopTrading();
                if (this.dataUpdateInterval) {
                    clearInterval(this.dataUpdateInterval);
                }
            }
        });
    </script>
</body>
</html>
